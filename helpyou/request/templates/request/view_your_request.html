{% extends 'base.html' %}
{% load staticfiles %}
{% load mathfilters %}
{% block startHeaders %}
    <script src="https://checkout.stripe.com/v2/checkout.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.js"></script>
{% endblock %}
{% block content %}
    <div class="large-9 columns">
        <div class="row main-content-top">
            <div class="large-6 columns">
                <h2 class="top-title"><span class="title-icon"><i
                        class="icon-reorder"></i></span>{{ request_your.title }}</h2>
            </div>
            <div class="large-6 columns">
                <ul class="breadcrumbs right">
                    <li><a href="/">Home</a></li>
                    <li><a href="{% url 'request:view_your' %}">Your Requests</a></li>
                    <li class="current">{{ request_your.title }}</li>
                </ul>
            </div>
        </div>
        <div class="row main-content">
            <div class="large-12 columns">
                <h3 class="color">Request</h3>

                <div class="large-6 columns">
                    <div class="rows">

                        <div class="panel">
                            <strong>Title: </strong>{{ request_your.title }}
                        </div>
                        <div class="panel">
                            <strong>Request: </strong>{{ request_your.request }}
                        </div>
                        <div class="panel">
                            <strong>Due By: </strong>{{ request_your.due_by }}
                        </div>
                        <div class="panel">
                            <strong>Reward: </strong>{{ request_your.reward }}
                        </div>
                        <div class="panel">
                            <strong>Max Reward: </strong>{{ request_your.max_reward }}
                        </div>
                        {% if user == request_your.user %}
                            <a class="button" href="{% url 'request:edit' request_your.id %}">Edit</a>
                        {% elif not have_responded %}
                            <a class="button" href="{% url 'response:create' request_your.id %}">Respond</a>
                        {% endif %}
                    </div>
                </div>
                <div class="large-6 columns" style="margin-top: -50px">
                    <h3 class="color" style="margin-left: -25px">Responses</h3>

                    <div class="rows">
                        {% for response_to in responses %}
                            <div class="panel" style="padding-bottom: 0">
                                <form id="form_{{ response_to.id }}" action="{% url 'response:buy' response_to.id %}"
                                      method="post">
                                    {% csrf_token %}
                                    <strong>{{ response_to.user.username }} is offering
                                        at: </strong> {{ response_to.price }}
                                    {% if user != response_to.buyer and response_to.price != 0 %}
                                        <input type="submit" class="button push-5" value="Buy"
                                               id="buy_{{ response_to.id }}">
                                        <script>
                                            var string = "#buy_{{ response_to.id }}";
                                            var string2 = "#form_{{ response_to.id }}";
                                            $(string).click(function () {
                                                var token = function (res) {
                                                    var $input = $('<input type=hidden name=stripeToken />').val(res.id);
                                                    $(string2).append($input).submit();
                                                };

                                                StripeCheckout.open({
                                                    key: 'pk_test_HlXsmOAZkKNhrPmUQ7w8Iumi',
                                                    address: false,
                                                    amount: {{ response_to.price|mul:100 }},
                                                    currency: 'cad',
                                                    name: "Buy Response",
                                                    description: "Asking Price: {{ response_to.price }}",
                                                    panelLabel: 'Buy Response For: ',
                                                    token: token
                                                });

                                                return false;
                                            });
                                        </script>
                                    {% else %}
                                         <a class="button push-5" href="{% url 'response:view_your_id' request_your.id %}">View</a>
                                    {% endif %}
                                </form>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- End Row -->
{% endblock %}
{% block additionalScripts %}
{% endblock %}
