{% extends 'base.html' %}
{% load staticfiles %}
{% block additionalHeaders %}
    <script src="{% static 'js/foundation/foundation.tab.js' %}"></script>/**
 * Created by tmehta on 20/03/14.
 */
/*! http://mths.be/placeholder v2.0.7 by @mathias */
;(function(window, document, $) {

	// Opera Mini v7 doesnâ€™t support placeholder although its DOM seems to indicate so
	var isOperaMini = Object.prototype.toString.call(window.operamini) == '[object OperaMini]';
	var isInputSupported = 'placeholder' in document.createElement('input') && !isOperaMini;
	var isTextareaSupported = 'placeholder' in document.createElement('textarea') && !isOperaMini;
	var prototype = $.fn;
	var valHooks = $.valHooks;
	var propHooks = $.propHooks;
	var hooks;
	var placeholder;

	if (isInputSupported && isTextareaSupported) {

		placeholder = prototype.placeholder = function() {
			return this;
		};

		placeholder.input = placeholder.textarea = true;

	} else {

		placeholder = prototype.placeholder = function() {
			var $this = this;
			$this
				.filter((isInputSupported ? 'textarea' : ':input') + '[placeholder]')
				.not('.placeholder')
				.bind({
					'focus.placeholder': clearPlaceholder,
					'blur.placeholder': setPlaceholder
				})
				.data('placeholder-enabled', true)
				.trigger('blur.placeholder');
			return $this;
		};

		placeholder.input = isInputSupported;
		placeholder.textarea = isTextareaSupported;

		hooks = {
			'get': function(element) {
				var $element = $(element);

				var $passwordInput = $element.data('placeholder-password');
				if ($passwordInput) {
					return $passwordInput[0].value;
				}

				return $element.data('placeholder-enabled') && $element.hasClass('placeholder') ? '' : element.value;
			},
			'set': function(element, value) {
				var $element = $(element);

				var $passwordInput = $element.data('placeholder-password');
				if ($passwordInput) {
					return $passwordInput[0].value = value;
				}

				if (!$element.data('placeholder-enabled')) {
					return element.value = value;
				}
				if (value == '') {
					element.value = value;
					// Issue #56: Setting the placeholder causes problems if the element continues to have focus.
					if (element != safeActiveElement()) {
						// We can't use `triggerHandler` here because of dummy text/password inputs :(
						setPlaceholder.call(element);
					}
				} else if ($element.hasClass('placeholder')) {
					clearPlaceholder.call(element, true, value) || (element.value = value);
				} else {
					element.value = value;
				}
				// `set` can not return `undefined`; see http://jsapi.info/jquery/1.7.1/val#L2363
				return $element;
			}
		};

		if (!isInputSupported) {
			valHooks.input = hooks;
			propHooks.value = hooks;
		}
		if (!isTextareaSupported) {
			valHooks.textarea = hooks;
			propHooks.value = hooks;
		}

		$(function() {
			// Look for forms
			$(document).delegate('form', 'submit.placeholder', function() {
				// Clear the placeholder values so they don't get submitted
				var $inputs = $('.placeholder', this).each(clearPlaceholder);
				setTimeout(function() {
					$inputs.each(setPlaceholder);
				}, 10);
			});
		});

		// Clear placeholder values upon page reload
		$(window).bind('beforeunload.placeholder', function() {
			$('.placeholder').each(function() {
				this.value = '';
			});
		});

	}

	function args(elem) {
		// Return an object of element attributes
		var newAttrs = {};
		var rinlinejQuery = /^jQuery\d+$/;
		$.each(elem.attributes, function(i, attr) {
			if (attr.specified && !rinlinejQuery.test(attr.name)) {
				newAttrs[attr.name] = attr.value;
			}
		});
		return newAttrs;
	}

	function clearPlaceholder(event, value) {
		var input = this;
		var $input = $(input);
		if (input.value == $input.attr('placeholder') && $input.hasClass('placeholder')) {
			if ($input.data('placeholder-password')) {
				$input = $input.hide().next().show().attr('id', $input.removeAttr('id').data('placeholder-id'));
				// If `clearPlaceholder` was called from `$.valHooks.input.set`
				if (event === true) {
					return $input[0].value = value;
				}
				$input.focus();
			} else {
				input.value = '';
				$input.removeClass('placeholder');
				input == safeActiveElement() && input.select();
			}
		}
	}

	function setPlaceholder() {
		var $replacement;
		var input = this;
		var $input = $(input);
		var id = this.id;
		if (input.value == '') {
			if (input.type == 'password') {
				if (!$input.data('placeholder-textinput')) {
					try {
						$replacement = $input.clone().attr({ 'type': 'text' });
					} catch(e) {
						$replacement = $('<input>').attr($.extend(args(this), { 'type': 'text' }));
					}
					$replacement
						.removeAttr('name')
						.data({
							'placeholder-password': $input,
							'placeholder-id': id
						})
						.bind('focus.placeholder', clearPlaceholder);
					$input
						.data({
							'placeholder-textinput': $replacement,
							'placeholder-id': id
						})
						.before($replacement);
				}
				$input = $input.removeAttr('id').hide().prev().attr('id', id).show();
				// Note: `$input[0] != input` now!
			}
			$input.addClass('placeholder');
			$input[0].value = $input.attr('placeholder');
		} else {
			$input.removeClass('placeholder');
		}
	}

	function safeActiveElement() {
		// Avoid IE9 `document.activeElement` of death
		// https://github.com/mathiasbynens/jquery-placeholder/pull/99
		try {
			return document.activeElement;
		} catch (err) {}
	}

}(this, document, jQuery));
{% endblock %}
{% block content %}
    {% include 'nav-bar.html' %}
    <div class="row">
        <div class="large-12 columns">
            <!-- Main Page Content and Sidebar -->
            <dl class="tabs" data-tab>
                <dd class="active"><a href="#panel2-1">Commission Earned</a></dd>
                <dd><a href="#panel2-2">Commission Paid</a></dd>
            </dl>
            <div class="tabs-content">
                <div class="content active" id="panel2-1">
                    <div class="row">
                        <div class="large-12 columns" role="content">
                            <article>
                                <h2>Commission Earned</h2>
                                <hr/>
                                <div class="row">
                                    <div class="large-12 columns">
                                        <div class="large-2 columns balance">
                                            ${{ seven|floatformat }}
                                            <div class="subcontent">PAST 7 DAYS</div>
                                        </div>
                                        <div class="large-4 columns balance centered">
                                            <div class="vr-left"></div>
                                            <div class="content">
                                                ${{ thirty|floatformat }}
                                                <div class="subcontent">PAST 30 DAYS</div>
                                            </div>
                                            <div class="vr-right"></div>
                                        </div>
                                        <div class="large-3 large-offset-3 columns balance">
                                            <div class="content">
                                                ${{ total_earned|floatformat }}
                                                <div class="subcontent">TOTAL</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="large-12 columns">
                                        <div class="cash-out">
                        <span class="grey-font">Amount available for cash out: <span
                                class="large-font"><strong>${{ profile.commission_earned }}</strong></span></span>
                                            <button id="cashout" class="button-important right [radius small round]">
                                                CASH OUT
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="panel payments extra-top-xlarge-margin">
                                    <div class="row">
                                        <div class="large-12 columns">
                                            <strong class="grey-font">Payments Recieved</strong>
                                            <hr>
                                        </div>
                                    </div>
                                    {% for transaction in transaction_list %}
                                        <div class="row extra-top-small-margin">
                                            <div class="large-12 columns">
                                                <span class="grey-font">{{ transaction.request.user }} &nbsp ${{ transaction.commission_paid|floatformat }} <span
                                                        class="right">{{ transaction.commission_time }}</span></span>
                                            </div>
                                        </div>
                                    {% endfor %}
                                </div>

                            </article>
                        </div>
                    </div>
                </div>
                <div class="content" id="panel2-2">
                    <div class="row">
                        <div class="large-12 columns" role="content">
                            <article>
                                <h2>Commission Paid (on successful leads)</h2>
                                <hr/>
                                <div class="row">
                                    <div class="large-12 columns">
                                        <div class="large-2 columns balance">
                                            ${{ last7_paid|floatformat }}
                                            <div class="subcontent">PAST 7 DAYS</div>
                                        </div>
                                        <div class="large-4 columns balance centered">
                                            <div class="vr-left"></div>
                                            <div class="content">
                                                ${{ last30_paid|floatformat }}
                                                <div class="subcontent">PAST 30 DAYS</div>
                                            </div>
                                            <div class="vr-right"></div>
                                        </div>
                                        <div class="large-3 large-offset-3 columns balance">
                                            <div class="content">
                                                ${{ total_paid|floatformat }}
                                                <div class="subcontent">TOTAL</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="panel payments extra-top-xlarge-margin">
                                    <div class="row">
                                        <div class="large-12 columns">
                                            <strong class="grey-font">Payments</strong>
                                            <input type="text" class="right" placeholder="Search">
                                            <hr>
                                        </div>
                                    </div>
                                    {% for response in paid_list %}
                                        <div class="row extra-top-small-margin">
                                            <div class="large-12 columns">
                                            <span class="grey-font">{{ response.user }} &nbsp ${{ response.commission_paid|floatformat }} <span
                                                    class="right">{{ response.commission_time }}</span></span>
                                            </div>
                                        </div>
                                    {% endfor %}
                                </div>

                            </article>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="light-box" id="collect-paypal">
        <i class="fa fa-times-circle-o close"
           style="margin-top: 7px; font-size: 1.5em; margin-right: 10px; float: right"></i>

        <div class="title-light">
            Cash Out
        </div>
        <div class="row content">
            <form action="{% url 'user:collect' %}">
                {% csrf_token %}
                <div class="row">
                    <div class="large-12 columns">
                        <input type="email" placeholder="Paypal Email Address" name="email"/>
                    </div>
                </div>
                <div class="row">
                    <div class="large-12 columns">
                        <button type="submit" class="button-important right [radius small round]">CASH OUT
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
{% endblock %}
{% block additionalScripts %}
    <script>
        $(function () {
            $('#cashout').click(function () {
                $('#collect-paypal').lightbox_me({centered: true});
            });
        });
    </script>
{% endblock %}